














<!DOCTYPE html>
<html lang='en-us'><head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='/pie-2022-03/hoverbois/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Software - Hoverbois</title>

    

    

    

    
        <meta property="og:title" content="Software" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://olincollege.github.io/pie-2022-03/hoverbois/docs/software/" />

    

    
        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Software"/>
<meta name="twitter:description" content=""/>

    <link rel="stylesheet" href="/pie-2022-03/hoverbois/style.min.5297c96c59a52afaa5bcda4a6cedf3813081f64025c209b25b2ee6d0c8f74d462b625ad3404a92a14d7a51b4ec0a420337ae70f426fa4bce2d5f7459a3ca7274.css" integrity="sha512-UpfJbFmlKvqlvNpKbO3zgTCB9kAlwgmyWy7m0Mj3TUYrYlrTQEqSoU16UbTsCkIDN65w9Cb6S84tX3RZo8pydA==">





    
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/pie-2022-03/hoverbois/js/header.7a2a109ec3782c57bad0332b662f8a5f41765505936b69868eb8bd5241de9daf23c388e82ca1831f6d09935013dcb9f71bfa7face3975880c1076028b7b0a6e1.js" integrity="sha512-eioQnsN4LFe60DMrZi&#43;KX0F2VQWTa2mGjri9UkHena8jw4joLKGDH20Jk1AT3Ln3G/p/rOOXWIDBB2Aot7Cm4Q=="></script>



    <script defer src="/pie-2022-03/hoverbois/js/zooming.684b5d075bf94d0adfa21a7e7eb9acec1ddfb2e7b47d6657981617f0db0cf50949f1172801595afa3051f51b28d67f6a2d0c41be677b59b564307d9dbe4a4fd2.js" integrity="sha512-aEtdB1v5TQrfohp&#43;frms7B3fsue0fWZXmBYX8NsM9QlJ8RcoAVla&#43;jBR9Rso1n9qLQxBvmd7WbVkMH2dvkpP0g=="></script>












</head><body>
        <main><header>
    <div class="brand">
        <div id="sidebar_btn">
            <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></svg>
        </div>

        <div>
            <a href="/pie-2022-03/hoverbois/">Hoverbois</a>
        </div>
    </div>

    <div class="toolbox">
        <div id="theme_tool">
            <svg id="dark_mode_btn" class="hidden toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></svg>
            <svg id="light_mode_btn" class="hidden toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></svg>
        </div>

        

        
    </div>
</header>
<nav id="navbar" class="pure-menu"><ul class="pure-menu-list"><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/about/" class="pure-menu-link">About Us</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/gallery/" class="pure-menu-link">Gallery</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/process/" class="pure-menu-link">Process</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/mechanical/" class="pure-menu-link">Mechanical</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/electrical/" class="pure-menu-link">Electrical</a>
                    
                </li><li class="navbar-item pure-menu-item active">
                    
                        <a href="/pie-2022-03/hoverbois/docs/software/" class="pure-menu-link">Software</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/pie-2022-03/hoverbois/docs/budget/" class="pure-menu-link">Budget</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="https://github.com/olincollege/hoverbois" class="pure-menu-link">GitHub</a>
                    
                </li></ul>
</nav>
<div id="sidebar_canvas_overlay" class="hidden"></div>
<div id="sidebar" class="close">
    <ul><li>
                    <a href="/pie-2022-03/hoverbois/docs/about/">About Us</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/gallery/">Gallery</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/process/">Process</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/mechanical/">Mechanical</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/electrical/">Electrical</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/software/">Software</a>
                </li><li>
                    <a href="/pie-2022-03/hoverbois/docs/budget/">Budget</a>
                </li><li>
                    <a href="https://github.com/olincollege/hoverbois">GitHub</a>
                </li></ul>
</div><div id="content" class="content-margin">
                


    <div class="content-margin">

<article class="line-numbers">
    
    
    <h1 id="hoverbot-software-development">Hoverbot Software Development</h1>
<p>This page describes the history of our hovercraft software (called
hovercraftpy) through our three design sprints. To view the code, please
checkout our repository on <a href="https://github.com/olincollege/hoverbois">GitHub</a>.</p>
<h2 id="architecture-overview">Architecture Overview</h2>
<p>The brain of the hovercraft is powered by a Raspberry Pi 3. All of the software
is written in Python. The components running on the Raspberry Pi are broken up
into <code>controllers</code> and <code>drivers</code>.</p>
<p>Controller modules exist to run the hovercraft&rsquo;s control loop:</p>
<ol>
<li>Read user input. Different versions of the controller module exist to read
different forms of input (web requests, bluetooth, USB radio).</li>
<li>Act on user input to update state</li>
<li>Send state to motor driver</li>
</ol>
<p>Driver modules exists to interface with external devices using protocols such
as USB, SPI, and IÂ²C. These devices include the Pi Pico, the IMU, and the GPS.
Drivers were based on an abstract base class called <code>HovercraftDriver</code>.</p>



<img src="/pie-2022-03/hoverbois/images/software-diagram.png" alt="Block diagram of software architecture.">

<p>Additional features and versions of drivers and controllers were added across
sprints.</p>
<h3 id="sprint-1">Sprint 1</h3>
<p>You can checkout the <code>end-of-sprint1</code> branch to view the software from this
sprint.</p>
<ul>
<li>
<p>Implemented a web-server based controller using
<a href="https://www.tornadoweb.org/en/stable/">Tornado</a>. The Raspberry Pi hosted a
simple website that allowed a user to send commands to the hovercraft.</p>
</li>
<li>
<p>Implemented a <a href="https://github.com/pyserial/pyserial">pySerial</a> based driver
to talk to the Pi Pico <a href="#firmware">firmware</a>. We used this driver to control
the thrust fan and the rudder.</p>
</li>
</ul>



<img src="/pie-2022-03/hoverbois/images/web-controller.png" alt="Screenshot of web controller website.">

<p>Screenshot of web controller website. The website listens to keyboard presses
and sends requests back to the Raspberry Pi.</p>
<h3 id="sprint-2">Sprint 2</h3>
<p>You can checkout the <code>sprint2</code> branch to view the software from this sprint.</p>
<ul>
<li>
<p>Refactored the codebase to use a proper Python project manager. Running
Python files directly with <code>python</code> limits the project to a single directory
as and makes it hard to manage dependencies. We ended up settling on
<a href="https://python-poetry.org/">Poetry</a> for its ease of use.</p>
</li>
<li>
<p>Extended the web controller allow control of the newly added hover motor.</p>
</li>
<li>
<p>Wrote a driver to talk to an IMU. This gave us access to accelerometer,
gyroscope, and magnetometer data.</p>
</li>
<li>
<p>Wrote a PID motor driver. This driver makes use of the original motor driver
(now extended to control hover motor) and the IMU driver. The PID loop takes
control of the hovercraft is told to not steer, and continuously adjusts the
rudder angle to bring angular velocity to zero.</p>
</li>
</ul>
<h3 id="sprint-3">Sprint 3</h3>
<p>This is the state of the <code>main</code> branch.</p>
<ul>
<li>
<p>Implemented a Bluetooth controller module. This module reads input from a
Bluetooth gamepad (specifically a Wii U Pro Controller), giving us access to
analog rudder control. This runs on the Raspberry Pi.</p>
</li>
<li>
<p>Extended web controller with a new request to receive analog controller data.</p>
</li>
<li>
<p>Wrote <a href="https://www.pygame.org/news">pygame</a> based applet to send web requests
from a different computer. This circumvents the need for the clunky website
and allows for analog control. In addition, this applet is extendable to use
another form of control, such as a USB radio module. This runs on a separate
laptop PC.</p>
</li>
<li>
<p>We started having issues with pySerial, resulting in an unacceptable input
delay of over a second. Unable to find the cause or a solution, we
implemented a non-ideal workaround using a system call to write to the serial
port. Unfortunately, using this method sometimes results in glitchy behavior
if the motor state is updated too frequently, making the PID driver unusable.</p>
</li>
</ul>



<img src="/pie-2022-03/hoverbois/images/robot-gui.gif" alt="GIF animation of Pygame robot gui.">

<h2 id="discord-bot">Discord Bot</h2>
<p>We needed to obtain the Raspberry Pi&rsquo;s local IP address to access the Raspberry
Pi over ssh and to control over http. Considering how our team already
communicated over Discord, we opted to write a Discord bot that would print the
Pi&rsquo;s IP to the chat. We also wrote a systemd unit file to start the Discord bot
on the Pi&rsquo;s boot. This bot served its purpose for the entirety of the project.</p>
<h2 id="firmware">Firmware</h2>
<p>The motors were driven by a Raspberry Pi Pico microcontroller (see
<a href="https://olincollege.github.io/pie-2022-03/hoverbois/docs/electrical/">electrical</a> for details).</p>
<p>The firmware reads the Pi Pico&rsquo;s serial buffer, parsing for commands in a
gcode-like format. Commands tell the Pico to update the speed of the motors and
the angle of the rudder servo. For some reason, the Pico read each command
twice, always once with an argument of zero. We solved this issue with a unique
bug fix: read a command twice before an action, and pick the higher value of
the two. This ensured that each operation was not immediately undone.</p>
<p>The firmware was the least changed part of the project across the design
sprints.</p>
<ul>
<li>Sprint 1: Controlled thrust motor and rudder servo.</li>
<li>Sprint 2: Added control for hover motor.</li>
<li>Sprint 3: Unchanged</li>
</ul>

</article>
</div>

    <div class="content-margin">

</div>
    




                
                    
                
            </div>
<footer>
    <article>Copyright Â© 2022 Ethan Chen, Joseph Gilbert, Devlin Ih, William Skelly</article>
</footer>

</main>
    </body>
</html>
